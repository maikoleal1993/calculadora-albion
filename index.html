<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculadora Crafteo Comidas - Albion</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  background:
    linear-gradient(rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.75)),
    url("778611.jpg") center/cover no-repeat fixed;
  font-family: 'Montserrat', sans-serif;
  margin: 0;
  padding: 20px;
}

.container {
  width: 100%;
  max-width: 640px;
  background: #222;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 0 30px rgba(255,160,0,0.25);
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  background: linear-gradient(135deg,#f90,#ffb347);
  border: none;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  color: #222;
}
button:hover { background: #ffb347; }
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 8px;
  border: none;
  background: #333;
  color: #fff;
  font-size: 0.95rem;
}
label {
  margin-top: 12px;
  display: block;
  font-size: 0.9rem;
}
.result {
  background: rgba(0,0,0,0.5);
  padding: 14px;
  margin-top: 14px;
  border-radius: 10px;
  font-size: 0.95rem;
}
.hidden { display: none; }
</style>
</head>

<body>

<div class="container">

  <h2 style="text-align:center;color:#ffb347;">üßÆ Calculadora crafteo de comidas</h2>

  <button id="btnCantidad">üìå Calcular por cantidad</button>
  <button id="btnInventario">üì¶ Calcular seg√∫n inventario</button>

  <!-- SECCI√ìN 1 -->
  <div id="section-cantidad" class="section">
    <label>Comida</label>
    <select id="comida1">
      <option value="tortilla">Tortilla de cerdo</option>
      <option value="pastel">Pastel de cerdo</option>
      <option value="guiso">Guiso de ternera</option>
    </select>

    <label>Variante</label>
    <select id="variante1">
      <option value="0">Plana</option>
      <option value="1">.1</option>
      <option value="2">.2</option>
      <option value="3">.3</option>
      <option value="a0">Avaloniana plana</option>
      <option value="a1">Avaloniana .1</option>
      <option value="a2">Avaloniana .2</option>
      <option value="a3">Avaloniana .3</option>
    </select>

    <label>Cantidad a fabricar (m√∫ltiplos de 10)</label>
    <input type="number" id="cantFabricar1" placeholder="Ej: 10">

    <label>% Devoluci√≥n</label>
    <input type="number" id="porDev1" placeholder="Ej: 35">

    <button onclick="calcularPorCantidad()">üîç Calcular ingredientes</button>
    <div id="resultado1" class="result"></div>
  </div>

  <!-- SECCI√ìN 2 -->
  <div id="section-inventario" class="section hidden">

    <label>Comida</label>
    <select id="comida2">
      <option value="tortilla">Tortilla de cerdo</option>
      <option value="pastel">Pastel de cerdo</option>
      <option value="guiso">Guiso de ternera</option>
    </select>

    <label>Variante</label>
    <select id="variante2">
      <option value="0">Plana</option>
      <option value="1">.1</option>
      <option value="2">.2</option>
      <option value="3">.3</option>
      <option value="a0">Avaloniana plana</option>
      <option value="a1">Avaloniana .1</option>
      <option value="a2">Avaloniana .2</option>
      <option value="a3">Avaloniana .3</option>
    </select>

    <label>% Devoluci√≥n</label>
    <input type="number" id="porDev2" placeholder="Ej: 35">

    <div id="invInputs"></div>

    <button onclick="calcularMaximo()">üî¢ ¬øCu√°ntas puedes craftear?</button>
    <div id="resultado2" class="result"></div>

  </div>

</div>

<script>
// ‚ñ∫ Datos de ingredientes
const comidas = {
  tortilla: {
    base: { "Fardos de ma√≠z": 36, "Carne de cerdo": 72, "Huevos de ganso": 18 }
  },
  pastel: {
    base: { "Fardos de ma√≠z": 18, "Harina": 36, "Carne de cerdo": 72, "Leche de oveja": 18 }
  },
  guiso: {
    base: { "Calabazas": 36, "Pan": 36, "Carne de ternera": 72 }
  }
};

const salsas = {
  1: "Salsa de pescado b√°sica",
  2: "Salsa de pescado extravagante",
  3: "Salsa de pescado especial"
};
const energiaAvalon = "Energ√≠a avaloniana";

// ‚ñ∫ Mostrar Inventario Inputs al cambiar selecci√≥n
document.getElementById("comida2").addEventListener("change", generarInventarioInputs);
document.getElementById("variante2").addEventListener("change", generarInventarioInputs);

// ‚ñ∫ Botones de navegaci√≥n
document.getElementById("btnCantidad").onclick = () => showSection('cantidad');
document.getElementById("btnInventario").onclick = () => showSection('inventario');

// ‚ñ∫ Mostramos "Por cantidad" por defecto al cargar
showSection('cantidad');

// ‚ñ∫ Funciones internas

function showSection(name) {
  document.getElementById("section-cantidad").classList.add("hidden");
  document.getElementById("section-inventario").classList.add("hidden");
  document.getElementById("resultado1").innerHTML = "";
  document.getElementById("resultado2").innerHTML = "";
  document.getElementById("section-" + name).classList.remove("hidden");

  if (name === "inventario") generarInventarioInputs();
}

function enMultiplo10(n) {
  return n > 0 && n % 10 === 0;
}

function calcularPorCantidad() {
  const c = document.getElementById("comida1").value;
  const v = document.getElementById("variante1").value;
  const cantidad = parseInt(document.getElementById("cantFabricar1").value);
  const dev = parseFloat(document.getElementById("porDev1").value)/100;

  if (!enMultiplo10(cantidad)) {
    document.getElementById("resultado1").innerHTML = "<b>‚ùå Ingresa un m√∫ltiplo de 10</b>";
    return;
  }

  let req = {};
  for (let ing in comidas[c].base) {
    req[ing] = comidas[c].base[ing]*cantidad;
  }

  if (v.startsWith("a")) {
    req[energiaAvalon] = 90*cantidad;
    let idx = parseInt(v.charAt(1));
    if (idx > 0) req[salsas[idx]] = 90*cantidad;
  } else {
    let idx = parseInt(v);
    if (idx>0) req[salsas[idx]] = 90*cantidad;
  }

  let out = "<b>Ingredientes necesarios</b><br>";
  for (let ing in req) {
    let real = req[ing]*(1-dev);
    out += `${ing}: <b>${real.toFixed(2)}</b><br>`;
  }
  document.getElementById("resultado1").innerHTML = out;
}

function generarInventarioInputs() {
  const cont = document.getElementById("invInputs");
  cont.innerHTML = "";

  const c = document.getElementById("comida2").value;
  const v = document.getElementById("variante2").value;

  for (let ing in comidas[c].base) {
    let inp = document.createElement("input");
    inp.placeholder = ing + " que tienes";
    inp.id = "inv_"+ing;
    cont.appendChild(inp);
  }

  if (v.startsWith("a")) {
    let invE = document.createElement("input");
    invE.placeholder = energiaAvalon + " que tienes";
    invE.id = "inv_"+energiaAvalon;
    cont.appendChild(invE);

    let idx = parseInt(v.charAt(1));
    if (idx>0) {
      let invS = document.createElement("input");
      invS.placeholder = salsas[idx]+" que tienes";
      invS.id = "inv_"+salsas[idx];
      cont.appendChild(invS);
    }
  } else {
    let idx = parseInt(v);
    if (idx>0) {
      let invS = document.createElement("input");
      invS.placeholder = salsas[idx]+" que tienes";
      invS.id = "inv_"+salsas[idx];
      cont.appendChild(invS);
    }
  }
}

function calcularMaximo() {
  const c = document.getElementById("comida2").value;
  const v = document.getElementById("variante2").value;
  const dev = parseFloat(document.getElementById("porDev2").value)/100;

  let perUnit = {};
  for (let ing in comidas[c].base) {
    perUnit[ing] = comidas[c].base[ing]*(1-dev);
  }

  if (v.startsWith("a")) {
    perUnit[energiaAvalon] = 90*(1-dev);
    let idx = parseInt(v.charAt(1));
    if (idx>0) perUnit[salsas[idx]] = 90*(1-dev);
  } else {
    let idx = parseInt(v);
    if (idx>0) perUnit[salsas[idx]] = 90*(1-dev);
  }

  let inv = {};
  for (let ing in perUnit) {
    inv[ing] = parseFloat(document.getElementById("inv_"+ing).value)||0;
  }

  let maxUnits = Infinity;
  for (let ing in perUnit) {
    let possible = Math.floor(inv[ing]/perUnit[ing]);
    if (possible < maxUnits) maxUnits = possible;
  }
  if (!isFinite(maxUnits)) maxUnits = 0;

  // ahora en m√∫ltiplos de 10
  let maxByTen = Math.floor(maxUnits/10)*10;

  let out = `<b>üëâ Puedes craftear hasta:</b><br><b>${maxByTen}</b> comidas (m√∫ltiplos de 10)<br><br>`;
  for (let ing in perUnit) {
    let used = perUnit[ing]*maxByTen;
    let diff = inv[ing] - used;
    if (diff>=0) out += `${ing}: üü¢ Sobra ${diff.toFixed(2)}<br>`;
    else out += `${ing}: üî¥ Falta ${Math.abs(diff).toFixed(2)}<br>`;
  }

  document.getElementById("resultado2").innerHTML = out;
}
</script>

</body>
</html>


